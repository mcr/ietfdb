{% extends "base.html" %}
{% load ietf_filters %}
{# Copyright The IETF Trust 2007, All Rights Reserved #}
{% load humanize %}

{% load dajaxice_templatetags %}

{% block title %}IETF {{ meeting.number }} Meeting Agenda: Timeslot/Room Availability{% endblock %}
{% load agenda_custom_tags %}
{% block pagehead %}
<link rel='stylesheet' type='text/css' href='/css/ietf.css' />

<script type='text/javascript' src='/js/jquery-1.8.2.min.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery-ui.custom.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery.ui.widget.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery.ui.droppable.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery.ui.sortable.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery.ui.accordion.js'></script>
<script type='text/javascript' src='/js/jquery-ui-1.9.0.custom/jquery.ui.draggable.js'></script>


{% if server_mode %}
	{% ifnotequal server_mode "production" %}
	<script src="https://towtruck.mozillalabs.com/towtruck.js"></script>
	{% endifnotequal %}
{% endif %}

{% dajaxice_js_import %}

<script type='text/javascript' src='/js/spin.js'></script>
<script type='text/javascript' src='/js/timeslot_edit.js'></script>
<script type='text/javascript' src='/js/agenda_helpers.js'></script>
<script type='text/javascript' src='/js/agenda_objects.js'></script>
<script type='text/javascript' src='/js/agenda_listeners.js'></script>


<script type='text/javascript'>

{% comment %}
function my_js_callback(data){
    alert(data.message);
}<!-- dajaxice example --> {% endcomment %}

var meeting_base_url = "{{ meeting_base_url }}";
var site_base_url = "{{ site_base_url }}";
total_days = {{time_slices|length}};
total_rooms = {{rooms|length}};
function setup_slots(){

{% for s in scheduledsessions %}
   make_ss({ "scheduledsession_id": "{{s.id}}",
     "empty": "{{s.empty_str}}",
     "timeslot_id":"{{s.timeslot.id}}",
     "session_id" :"{{s.session.id}}",
     "room"       :"{{s.timeslot.location|slugify}}",
     "roomtype"   :"{{s.timeslot.type|lower}}",
     "time"       :"{{s.timeslot.time|date:'Hi' }}",
     "date"       :"{{s.timeslot.time|date:'Y-m-d'}}",
     "domid"      :"{{s.timeslot.js_identifier}}"});
{% endfor %}

   console.log("setup_slots run");
}

</script>
<style type='text/css'>

</style>
{% endblock pagehead %}


{% block noTable %}
</tr></table></div>
<div class="wrapper custom_text_stuff">
<div style="ui-icon ui-icon-arrow-1-w" id="CLOSE_IETF_MENUBAR">
<

</div>

<div class="agenda_div">

<table id="meetings" class="ietf-navbar" style="width:100%">
  <th class="schedule_title"><span id="schedule_name">name: {{schedule.name}}</span>
  <div id="spinner"><!-- spinney goes here --></div>
  </th>
{% for day in time_slices %}
  <th colspan="{{date_slices|colWidth:day}}" id="{{day|date:'Y-m-d'}}-btn" class=" day_{{day}} agenda_slot_title">
    <div class="delete delete_day bottom_left" id="delete_{{day|date:'Y-m-d'}}">X</div>
    {{day|date:'D'}}&nbsp;({{day}})

  </th>
  <th class="day_{{day}} spacer {{day|date:'Y-m-d'}}-spacer" id="">
    <div class="ui-widget-content ui-resizable" id="resize-{{day|date:'Y-m-d'}}-spacer">
      <div class="spacer_grip ui-resizable-handle ui-resizable-e"></div>
    </div>
</th>
{% endfor %}
    <tr>
      <th>
        <div class="addbutton" id="addroom">+ROOM</div>
        <div class="addbutton" id="addday">+DAY</div>
      </th>
    {% for day in time_slices %}
	  {% for slot in date_slices|lookup:day %}
	      <th class="day_{{day}} room_title">
                  <div class="delete delete_slot bottom_left" id="delete_{{day|date:'Y-m-d'}}_{{slot.0|date:'Hi'}}">X</div>
              {{slot.0|date:'Hi'}}-{{slot.1|date:'Hi'}}
              </th>

	  {% endfor %}
              <th class="day_{{day}} spacer {{day|date:'Y-m-d'}}-spacer">
	      </div></th>

    {% endfor %}

  {% for r in rooms %}
  <tr id="{{r|to_acceptable_id}}" class="agenda_slot">
    <th class="vert_time">
      <div class="delete delete_room bottom_left" id="delete_{{r|to_acceptable_id}}">X</div>
      <div class="right room_name">{{r}}</div>

      <!-- <span class="hide_room light_blue_border">X</span><span class="left">{{r}}</span></th> -->
    {% for day in time_slices %}
      {% for slot in date_slices|lookup:day %}
        <td id="{{r|slugify}}_{{day}}_{{slot.0|date:'Hi'}}" class="day_{{day}} agenda-column-{{day}}-{{slot.0|date:'Hi'}} agenda_slot {% cycle 'agenda_slot_alt' '' %} agenda_slot_unavailable" ></td>
      {% endfor %}
        <td class="day_{{day}} spacer {{day|date:'Y-m-d'}}-spacer"></td>
    {% endfor %}
  </tr>
  {% endfor %}
</table>

</div>
<div id="addroom_form">
   <form action="{{addroomurl}}" method="post">{% csrf_token %}
      <table>
        {{ addroom.as_table }}
      <tr><td><input type="submit" name="addroom" value="addroom"></td></tr>
      </table>
   </form>
   <div id="addform_cancel">X</div>
</div>
<div id="addday_form">
   <table>
      <form action="{{adddayurl}}" method="post">{% csrf_token %}
        {{ addday.as_table }}
        <tr><td><input type="submit" name="addday" value="addday"></td></tr>
      </form>
   </table>
   <div id="addday_cancel">X</div>
</div>

{% if server_mode %}
	{% ifnotequal server_mode "production" %}
	<button onclick="TowTruck(this); return false;">Start TowTruck</button>
	{% endifnotequal %}
{% endif %}
{% endblock %}
